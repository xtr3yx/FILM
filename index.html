<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Układ strony</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      font-size: 18px;      
      height: 3200px; /* Zwiększona wysokość dla dwóch kontenerów */
    }

    .container {
      width: 2300px;
      margin: 0 auto;
      height: 1600px;
      margin-bottom: 20px; /* Odstęp między kontenerami */
    }

    .title {
      color: black;
      text-align: center;
      padding: 20px;
      font-size: 24px;
      font-weight: bold;
    }

    .content {
      display: grid;
      grid-template-columns: 1fr 2fr 1fr;
    }

    .left {
      padding: 20px;
    }

    .up {
      padding: 20px;
    }

    .right {
      padding: 20px;
    }

    .contentF {
        display: grid;
      grid-template-columns: 1fr 1fr;
    }

    .footL {
      padding: 20px;
    }

    .footR {
      padding: 20px;
    }

    .main {
      grid-column: span 3;
      padding: 20px;
    }
    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    .form-group select,
    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid black;
      border-radius: 4px;
      box-sizing: border-box;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }

    th,
    td {
      border: 1px solid black;
      padding: 10px;
      text-align: center;
    }

    th {
      background-color: #f5f5f5;
    }

    td {
      height: 50px;
      vertical-align: middle;
    }

    button {
      margin-top: 10px;
      padding: 10px 20px;
      border: none;
      cursor: pointer;
      font-size: 16px;
    }

  


    input,
    select {
      width: 100%;
      box-sizing: border-box;
      border: none;
      padding: 0px;
      font-size: 18px;
    }

    td select {
      width: 100%;
      height: 100%;
      box-sizing: border-box;
      border: none;
      padding: 5px;
    }

    select {
      appearance: none;
      -moz-appearance: none;
      -webkit-appearance: none;
      background-color: #ffffff;
      border: 1px solid #ccc;
      padding: 5px;
      font-size: 18px;
      border-radius: 4px;
      width: 100%;
      color: black;
    }

    textarea {
      resize: none;
      width: 100%;
      height: 100%;
    }
    .form-group-container {
    display: flex;
    gap: 20px; /* Odstęp między polami */
    align-items: center;
}

.form-group {
    flex: 1; /* Oba pola będą tej samej szerokości */
    min-width: 200px;
}

  </style>
</head>
<body>
  <!-- Pierwszy kontener -->
  <div class="container" id="container1">
    <!-- Title -->
    <div class="title">Pomiar przed montażem stolarki drzwiowej</div>

    <!-- Layout -->
    <div class="content">
        <div class="left">
            <div class="form-group">
              <label for="clientName">Imię i nazwisko:</label>
              <input type="text" id="clientName" style="min-width: 300px;">
            </div>
              <div class="form-group">
              <label for="phoneNumber">Telefon:</label>
              <input type="text" id="phoneNumber">
            </div>
            <div class="form-group">
              <label for="contractAddress">Adres:</label>
              <textarea id="contractAddress" rows="2" style="width: 100%; resize: none; border: 1px solid black; border-radius: 4px; padding: 8px; box-sizing: border-box; overflow: hidden; font-size: 18px;" oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px';">
              </textarea>
            </div>
    
          </div>
          <!-- Górny panel -->
          <div class="up">
            <div class="form-group-container">
              <div class="form-group">
                  <label for="joiningType">Łączenie opaski:</label>
                  <select id="joiningType" onchange="handleCustomOption(this)">
                      <option value="" selected disabled></option>
                      <option value="45">45°</option>
                      <option value="90">90°</option>
                  </select>
              </div>
              <div class="form-group">
                  <label for="bandWidth">Szerokość opaski:</label>
                  <select id="bandWidth" onchange="handleCustomOption(this)">
                      <option value="" selected disabled></option>
                      <option value="63">63mm</option>
                      <option value="70">70mm</option>
                      <option value="80">80mm</option>
                      <option value="inna">INNE</option>
                  </select>
              </div>
          </div>
          
            <div class="form-group">
              <label for="productDescription">Ogólny Opis Produktów:</label>
              <select id="productDescription" onchange="handleCustomOption(this)">
                <option value="" selected disabled></option>
                <option value="PORTA">PORTA</option>
                <option value="POL-SKONE">POL-SKONE</option>
                <option value="DRE">DRE</option>
                <option value="VASCO">VASCO</option>
                <option value="BARAŃSKI">BARAŃSKI</option>
                <option value="INTENSO">INTENSO</option>
                <option value="WIKĘD">WIKĘD</option>
                <option value="inna">INNE</option>
              </select>
            </div>
            <div class="form-group">
              <textarea id="additionalNotes" rows="4" placeholder="" style="resize: none;">
              </textarea>
            </div>
          </div>
          <!-- Prawy panel -->
          <div class="right">
            <h3>Informacje o montażyście</h3>
            <p>
              <strong>Imię i nazwisko:</strong>Jan Kowalski</p>
            <p>
              <strong>Telefon:</strong>+48 123 456 789</p>
          </div>
    
    </div>

    <!-- Main -->
    <div class="main">
        <button onclick="saveToPDF()">Zapisz do PDF</button>

      <button id="addRow">Dodaj wiersz</button>
      <table id="data-table1">
        <thead>
          <tr>
            <th style="min-width: 30px;"></th>
            <th style="min-width: 150px;">Rodzaj pomieszczenia</th>
            <th style="min-width: 30px;">Wysokość otworu (cm)</th>
            <th style="min-width: 30px;">Szerokość otworu (cm)</th>
            <th style="min-width: 200px;">Grubość muru (cm)</th>
            <th style="min-width: 130px;">Rodzaj drzwi</th>
            <th style="min-width: 110px;">Rodzaj zamka</th>
            <th style="min-width: 280px;">Inne</th>
            <th style="min-width: 200px;">Zakres prac przewidzianych do wykonania przez Zleceniodawce przed Montażem</th>
            <th style="min-width: 80px;">Strona L/P</th>
            <th style="min-width: 80px;">Szerokość skrzydła</th>
            <th style="min-width: 80px;">Zakres ościeżnicy (cm)</th>
            <th style="min-width: 230px;">Zakres prac przewidzianych do wykonania przez Montażystę podczas montażu</th>
            <th style="min-width: 90px;">Wycena netto</th>
          </tr>
        </thead>
        <tbody id="table-body1"></tbody>
      </table>
    </div>

    <!-- Footer -->
    <div class="contentF" id="footer">
      <div class="footL">
        <p>Podpis Montażysty:</p>
        <div style="display: flex; align-items: center; gap: 10px;">
          <button class="no-print" style="padding: 10px 20px; font-size: 16px;" onclick="clearCanvas('client-signature')">Wyczyść</button>
          <canvas id="client-signature" class="signature-canvas" width="500" height="130" style="border: 1px solid black;"></canvas>
        </div>
      </div>
      <div class="footR">  <p>Podpis Zleceniodawcy:</p>
        <div style="display: flex; align-items: center; gap: 10px;">
          <canvas id="installer-signature" class="signature-canvas" width="500" height="130" style="border: 1px solid black;"></canvas>
          <button class="no-print" style="padding: 10px 20px; font-size: 16px;" onclick="clearCanvas('installer-signature')">Wyczyść</button>
        </div></div>
    </div>
  </div>

  <!-- Drugi kontener -->
  <div class="container" id="container2">
    <!-- Tabela bez thead -->
    <div class="main">
        <table id="data-table2">
            <tbody id="table-body2"></tbody>
          </table>
    </div>
  </div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  
  <script>
document.getElementById('addRow').addEventListener('click', function () {
    const container1 = document.getElementById('container1'); // Pierwszy kontener
    const container2 = document.getElementById('container2'); // Drugi kontener
    const footer = document.getElementById('footer'); // Stopka
    const table1 = document.getElementById('table-body1'); // Tabela 1 (tbody)
    const table2 = document.getElementById('table-body2'); // Tabela 2 (tbody)

    // Pobierz wymiary i pozycje
    const containerBottom = container1.offsetTop + container1.offsetHeight; // Dół kontenera 1
    const footerTop = footer.offsetTop; // Górna pozycja stopki
    const footerHeight = footer.offsetHeight; // Wysokość stopki

    // Sprawdzenie, czy stopka faktycznie **przekroczyła** dolną krawędź kontenera 1
    const isFooterOverlapping = (footerTop + footerHeight) > containerBottom;

    // **Jeśli stopka jest w drugim kontenerze, ale w pierwszym jest jeszcze miejsce**
    const isFooterInContainer2 = container2.contains(footer);
    const maxRowsInContainer1 = 13; // Maksymalna liczba wierszy w tabeli 1
    const hasSpaceInContainer1 = table1.children.length < maxRowsInContainer1;

    let targetTable = table1; // Domyślnie dodajemy do pierwszej tabeli

    // Jeśli stopka jest już w drugim kontenerze, ale pierwszy nie jest pełny -> dodaj tam wiersz
    if (isFooterInContainer2 && hasSpaceInContainer1) {
        targetTable = table1;
    }
    // Jeśli **stopka przekroczyła limit** i nie ma już miejsca -> dodaj do drugiego kontenera
    else if (isFooterOverlapping) {
        if (!isFooterInContainer2) {
            container2.appendChild(footer); // Przenieś stopkę do drugiego kontenera
            console.log("Footer przeniesiony do drugiego kontenera.");
        }
        targetTable = table2;
    }

    // Obliczanie poprawnego numeru wiersza
    const totalRows = table1.children.length + table2.children.length;
    const rowNumber = totalRows + 1;

    // Dodaj nowy wiersz do odpowiedniej tabeli
    const row = document.createElement("tr");
    row.innerHTML = `
        <td></td> <!-- Numeracja zostanie zaktualizowana później -->
            <td>
                <select onchange="handleCustomOption(this)">
                    <option value="" selected></option>
                    ${[
                        "WIATROŁAP", "SALON", "GOŚCINNY", "SYPIALNIA", "GARDEROBA", 
                        "KUCHNIA", "SPIŻARNIA", "WC", "ŁAZIENKA", "PRALNIA", 
                        "BIURO", "GABINET", "KOTŁOWNIA", "SCHODY", "GARAŻ", "SCHOWEK"
                    ]
                        .map(value => `<option value="${value}">${value}</option>`)
                        .join("")}
                    <option value="inna">INNE</option>
                </select>
            </td>
            <td>
                <select>
                    <option value="" selected></option>
                    ${Array.from({ length: 31 }, (_, index) => {
                        const value = 190 + index;
                        return `<option value="${value}">${value}</option>`;
                    }).join('')}
                </select>
            </td>
            <td>
                <select>
                    <option value="" selected></option>
                    ${Array.from({ length: 71 }, (_, index) => {
                        const value = 50 + index;
                        return `<option value="${value}">${value}</option>`;
                    }).join('')}
                </select>
            </td>
            <td>
                <div style="display: flex; align-items: center; gap: 5px;">
                    <select>
                        <option value="" selected></option>
                        ${Array.from({ length: (32 - 8) * 2 + 1 }, (_, index) => {
                            const value = (8 + index * 0.5).toFixed(1);
                            return `<option value="${value}">${value}</option>`;
                        }).join('')}
                    </select>
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="checkbox" value="+1.5"> +1,5cm płytki
                    </label>
                </div>
            </td>
            <td>
                <select onchange="handleCustomOption(this)">
                    <option value="" selected></option>
                    ${[
                        "PRZYLGOW", "BEZPRZYLGOWE", "REWERS", "UKRYTE", 
                        "UKRYTE REWERS", "PRZESUWANE", "TECHNICZNE", "PPOŻ", "TUNEL"
                    ]
                        .map(value => `<option value="${value}">${value}</option>`)
                        .join("")}
                    <option value="INNA">INNA</option>
                </select>
            </td>
            <td>
                <select onchange="handleCustomOption(this)">
                    <option value="" selected></option>
                    ${["OSZCZ", "WC", "KLUCZ", "YALE"]
                        .map(value => `<option value="${value}">${value}</option>`)
                        .join('')}
                    <option value="inna">INNE</option>
                </select>
            </td>
            <td>
                <select onchange="handleCustomOption(this)">
                    <option value="" selected></option>
                    ${[
                        "PODCIĘCIE WENTYLACYJNE", "TULEJE WENTYLACYJNE", 
                        "SKRÓT REKUPERACYJNY", "OPASKA Z DŁUŻSZYM PIÓREM", 
                        "USZCZELKA OPADAJĄCA"
                    ]
                        .map(value => `<option value="${value}">${value}</option>`)
                        .join('')}
                    <option value="inna">INNE</option>
                </select>
            </td>
            <td>
                <textarea 
                    placeholder="" 
                    style="
                        width: 100%; 
                        height: auto; 
                        resize: none; 
                        border: none; 
                        box-sizing: border-box; 
                        font-size: 18px; 
                        overflow: hidden;" 
                    oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px'">
                </textarea>
            </td>
            <td>
                <select>
                    <option value="" selected></option>
                    <option value="LW">LW</option>
                    <option value="PW">PW</option>
                    <option value="LZ">LZ</option>
                    <option value="PZ">PZ</option>
                </select>
            </td>
            <td>
                <select onchange="handleCustomOption(this)">
                    <option value="" selected></option>
                    ${[60, 70, 80, 90, 100]
                        .map(value => `<option value="${value}">${value}</option>`)
                        .join('')}
                    <option value="inna">INNE</option>
                </select>
            </td>
            <td>
                <select onchange="handleCustomOption(this)">
                    <option value="" selected></option>
                    ${Array.from({ length: 31 }, (_, index) => {
                        const start = 75 + index * 10;
                        return `<option value="${start}-${start + 10}">${start}-${start + 10}</option>`;
                    }).join('')}
                    <option value="inna">INNE</option>
                </select>
            </td>
            <td>
                <textarea 
                    placeholder="" 
                    style="
                        width: 100%; 
                        height: auto; 
                        resize: none; 
                        border: none; 
                        box-sizing: border-box; 
                        font-size: 18px; 
                        overflow: hidden;" 
                    oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px'">
                </textarea>
            </td>            
            <td><input type="number" class="price-input" placeholder=""></td>
        `;

    targetTable.appendChild(row);
    updateRowNumbers(); // Aktualizujemy numerację wierszy po dodaniu nowego
});

// Funkcja do aktualizacji numeracji wierszy
function updateRowNumbers() {
    const table1Rows = document.querySelectorAll("#table-body1 tr");
    const table2Rows = document.querySelectorAll("#table-body2 tr");

    let index = 1;
    table1Rows.forEach(row => {
        row.cells[0].textContent = index++; // Ustaw numerację w pierwszej tabeli
    });
    table2Rows.forEach(row => {
        row.cells[0].textContent = index++; // Kontynuacja numeracji w drugiej tabeli
    });
}
async function saveToPDF() {
    const { jsPDF } = window.jspdf; // Pobierz jsPDF poprawnie

    const container1 = document.getElementById('container1'); // Pierwszy kontener
    const container2 = document.getElementById('container2'); // Drugi kontener

    if (!container1 || !container2) {
        console.error("Nie znaleziono kontenerów!");
        alert("Błąd: Nie znaleziono kontenerów do zapisania!");
        return;
    }

    // Tworzymy nowy element dla eksportu PDF
    const combinedContainer = document.createElement('div');
    combinedContainer.appendChild(container1.cloneNode(true));
    combinedContainer.appendChild(container2.cloneNode(true));

    combinedContainer.style.position = "absolute";
    combinedContainer.style.left = "-9999px"; // Ukryj element poza ekranem
    document.body.appendChild(combinedContainer); // Tymczasowo dodaj do DOM

    const options = {
        scale: 2, // Skalowanie dla lepszej jakości
        useCORS: true, // Obsługa obrazów z CORS
        logging: true, // Debugowanie w konsoli
        backgroundColor: "#ffffff", // Wymuszenie białego tła
    };

    try {
        const canvas = await html2canvas(combinedContainer, options);
        const imgData = canvas.toDataURL('image/png'); // Konwertuj na obraz PNG
        const pdf = new jsPDF('l', 'pt', 'a4'); // Tworzenie PDF w orientacji landscape

        const a4Width = 841.89; // Szerokość A4 w punktach (landscape)
        const a4Height = 595.28; // Wysokość A4 w punktach (landscape)
        const imgWidth = a4Width; // Dopasowanie szerokości obrazu do A4
        const imgHeight = (canvas.height * a4Width) / canvas.width; // Proporcjonalna wysokość

        if (imgHeight <= a4Height) {
            // Jeśli wszystko mieści się na jednej stronie
            pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
        } else {
            // Jeśli treść wymaga wielu stron
            let position = 0;

            while (position < canvas.height) {
                const pageCanvas = document.createElement('canvas');
                pageCanvas.width = canvas.width;
                pageCanvas.height = a4Height * (canvas.width / a4Width);

                const pageContext = pageCanvas.getContext('2d');
                pageContext.drawImage(
                    canvas,
                    0,
                    position,
                    canvas.width,
                    pageCanvas.height,
                    0,
                    0,
                    pageCanvas.width,
                    pageCanvas.height
                );

                const imgDataPage = pageCanvas.toDataURL('image/png');
                pdf.addImage(imgDataPage, 'PNG', 0, 0, imgWidth, a4Height);

                position += pageCanvas.height;

                if (position < canvas.height) {
                    pdf.addPage(); // Dodaj nową stronę
                }
            }
        }

        pdf.save('kontenery.pdf'); // Zapisz plik PDF
    } catch (error) {
        console.error("Błąd przy generowaniu PDF:", error);
        alert("Wystąpił błąd przy generowaniu PDF. Sprawdź konsolę.");
    } finally {
        document.body.removeChild(combinedContainer); // Usuń tymczasowy kontener po zapisie
    }
}

  </script>
</body>
</html>
